(function(){function t(t,e){return function(o){o.keyCode===e&&(t.toggle(),o.preventDefault())}}function e(t){var e=0;return function(o){switch(o.keyCode){case 38:void 0!==t.history[e]&&(o.target.value=t.history[e++]),e>=t.history.length&&(e=t.history.length-1),o.preventDefault();break;case 40:void 0!==t.history[e]&&(o.target.value=t.history[e--]),0>e&&(e=0);break;default:e=0,t.history[0]=o.target.value}}}function o(t){return function(e){switch(e.keyCode){case 13:var o=e.target.value;e.target.value="",o&&t.log("command",o),t.history.unshift(""),t.history.length>t.cfg.historySize&&(t.history=t.history.splice(0,t.cfg.historySize)),t.dispatch(o)}}}function n(t){t&&(document.head.appendChild(a.toElement("<style>"+t+"</style>")),l=!1)}var i=this,s={hotKey:192,welcome:"",onShow:null,onHide:null,caseSensitive:!1,historySize:256},l=".console-panel{z-index:99999;display:block;visibility:hidden;height:50%;position:fixed;top:0;left:0;width:100%;background-color:rgba(0,0,0,.8);margin-top:-50%;transition:margin-top 100ms ease-out 1ms}.console-panel.shown{visibility:visible;margin-top:0}.console-history,.console-input{margin:0;padding:2px 5px;box-sizing:border-box;position:absolute;width:100%;font:14px/20px Menlo,monospace;color:#DDD;letter-spacing:.05em}.console-history{bottom:18px}.console-history dd,.console-history dt{white-space:pre;margin:0}.console-history dt{color:#7E0}.console-input{outline:0;background-color:transparent;border:0;bottom:0;line-height:16px;padding:4px 5px}",r='<label class="console-panel"><dl class="console-history"></dl><input class="console-input"/></label>';i.Console=function(i,c){var h=a.defaults(c||{},s);h.historySize++,this.history=[],this.cfg=h,this.commands={};for(var d in i)i.hasOwnProperty(d)&&(this.commands[d]={__fn:i[d]});this.panelEl=a.toElement(r),this.logEl=this.panelEl.firstChild,this.inputEl=this.logEl.nextSibling,h.hotKey&&window.addEventListener("keydown",t(this,h.hotKey)),h.welcome&&this.log("message",h.welcome),this.inputEl.addEventListener("keydown",e(this)),this.inputEl.addEventListener("keyup",o(this)),document.body.appendChild(this.panelEl),n(l)},Console.prototype.toggle=function(t){"off"===t||this.isShown?(a.removeClass(this.panelEl,"shown"),this.isShown=!1,a.isFunction(this.cfg.onHide)&&this.cfg.onHide(this)):"on"!==t&&this.isShown||(a.addClass(this.panelEl,"shown"),this.inputEl.focus(),this.isShown=!0,a.isFunction(this.cfg.onShow)&&this.cfg.onShow(this))},Console.prototype.log=function(t){var e,o=Array.prototype.slice.call(arguments,1);switch(t){case"command":e=a.toElement("<dt></dt>"),e.appendChild(document.createTextNode(o[0]));break;case"message":e=a.toElement("<dd>"+o.join(" ")+"</dd>");break;default:o.unshift(t),e=a.toElement("<dd>"+o.join(" ")+"</dd>")}this.logEl.appendChild(e)},Console.prototype.dispatch=function(t){var e=t.split(" "),o=this.commands[e[0]];if(o){for(;a.isString(o.__fn);)if(o=this.commands[o.__fn],o===e[0])throw new Error("Alias loop.");var n=o&&o.__fn.apply(o,e.splice(1));n&&this.log("message",n)}},Console.prototype.register=function(t,e,o){return this.commands[t]=a.defaults({__fn:e},o),this};var a={defaults:function(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){for(var o in e)void 0===t[o]&&(t[o]=e[o])}),t},toElement:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},preventDefault:function(t){t.preventDefault()},hasClass:function(t,e){new RegExp("\\b"+e+"\\b").test(t.className)},removeClass:function(t,e){t.className=t.className.replace(new RegExp("\\b ?"+e+"\\b","g"),"")},addClass:function(t,e){t.className=t.className.replace(new RegExp("\\b"+e+"\\b|$")," "+e)},isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"[object Number]"===toString.call(t)},isString:function(t){return"[object String]"===toString.call(t)}};"function"==typeof define&&define.amd&&define([],function(){return Console})}).call(this);
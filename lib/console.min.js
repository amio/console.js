(function(){function t(t,e){return function(o){o.keyCode===e&&(t.toggle(),o.preventDefault())}}function e(t){var e=0;return function(o){var n=o.target.value.toLowerCase();switch(o.keyCode){case 13:t.history[0]=n,o.target.value="",n&&t.log("command",n),t.history.unshift(""),t.history.length>t.cfg.historySize&&(t.history=t.history.splice(0,t.cfg.historySize)),t.dispatch(n);break;case 38:void 0!==t.history[e+1]&&(o.target.value=t.history[++e]),e>=t.history.length&&(e=t.history.length-1),o.preventDefault();break;case 40:""!==t.history[e]&&(o.target.value=t.history[--e]),0>e&&(e=0);break;case 9:e=0,t.history[0]=o.target.value=t.autoComplete(),o.preventDefault();break;default:e=0,t.history[0]=o.target.value}}}function o(t){t&&(document.head.appendChild(a.toElement("<style>"+t+"</style>")),s=!1)}var n=this,i={hotkey:192,welcome:"",onShow:null,onHide:null,defaultHandler:null,caseSensitive:!1,historySize:256},s=".console-panel{z-index:99999;display:block;visibility:hidden;height:50%;position:fixed;top:0;left:0;width:100%;background-color:rgba(0,0,0,.8);margin-top:-50%;transition:margin-top 100ms ease-out 1ms}.console-panel.shown{visibility:visible;margin-top:0}.console-history,.console-input{margin:0;padding:2px 5px;box-sizing:border-box;position:absolute;width:100%;font:14px/20px Menlo,monospace;color:#DDD;letter-spacing:.05em}.console-history{bottom:18px}.console-history dd,.console-history dt{white-space:pre;margin:0}.console-history dt{color:#7E0}.console-input{outline:0;background-color:transparent;border:0;bottom:0;line-height:16px;padding:4px 5px}",l='<label class="console-panel"><dl class="console-history"></dl><input class="console-input"/></label>',r=null;n.Console=function(n,r){var c=a.defaults(r||{},i);c.historySize++,this.history=[],this.cfg=c,this.commands={};for(var h in n)n.hasOwnProperty(h)&&this.register(h,n[h]);this.panelEl=a.toElement(l),this.logEl=this.panelEl.firstChild,this.inputEl=this.logEl.nextSibling,c.hotkey&&(this.hotkeyListener=t(this,c.hotkey),window.addEventListener("keydown",this.hotkeyListener)),this.inputEl.addEventListener("keydown",e(this)),c.welcome&&this.log("message",c.welcome),document.body.appendChild(this.panelEl),o(s)},Console.prototype.log=function(t){var e,o=Array.prototype.slice.call(arguments,1);switch(t){case"command":e=a.toElement("<dt></dt>"),e.appendChild(document.createTextNode(o[0]));break;case"message":e=a.toElement("<dd>"+o.join(" ")+"</dd>");break;default:o.unshift(t),e=a.toElement("<dd>"+o.join(" ")+"</dd>")}this.logEl.appendChild(e)},Console.prototype.dispatch=function(t){var e,o=t.split(" "),n=this.cfg.caseSensitive===!1?o[0].toLowerCase():o[0],i=this.commands[n];if(i){for(;a.isString(i.__fn);)if(i=this.commands[i.__fn],i===n)throw new Error("Alias loop.");e=i&&i.__fn.apply(i,o.splice(1))}else a.isFunction(this.cfg.defaultHandler)&&(e=this.cfg.defaultHandler.apply(this,o));e&&this.log("message",e)},Console.prototype.toggle=function(t){"off"===t||this.isShown?(r=!1,a.removeClass(this.panelEl,"shown"),this.inputEl.blur(),this.isShown=!1,a.isFunction(this.cfg.onHide)&&this.cfg.onHide(this)):"on"!==t&&this.isShown||(r&&r.toggle("off"),r=this,a.addClass(this.panelEl,"shown"),this.inputEl.focus(),this.isShown=!0,a.isFunction(this.cfg.onShow)&&this.cfg.onShow(this))},Console.prototype.register=function(t,e,o){return this.cfg.caseSensitive===!1&&(t=t.toLowerCase()),this.commands[t]=a.defaults({__fn:e},o),this},Console.prototype.destroy=function(){this.hotkeyListener&&window.removeEventListener("keydown",this.hotkeyListener),document.body.removeChild(this.panelEl)},Console.prototype.printHelp=function(t){var e,o,n,i=(this.commands,Object.keys(this.commands).sort());for(a.isFunction(t)&&(i=i.filter(t)),e=0;e<i.length;e++)o=this.commands[i[e]],n="",o.usage&&(n+=" "+o.usage),o.desc&&(n+=" "+o.desc),this.log(n)},Console.prototype.autoComplete=function(){var t=this.inputEl.value;if(""===t)return t;var e=function(e){return 0===e.indexOf(t)},o=Object.keys(this.commands).filter(e);switch(o.length){case 0:return t;case 1:return o[0]+" ";default:return this.log("message",t),this.printHelp(e),t}};var a={defaults:function(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){for(var o in e)void 0===t[o]&&(t[o]=e[o])}),t},toElement:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},preventDefault:function(t){t.preventDefault()},hasClass:function(t,e){new RegExp("\\b"+e+"\\b").test(t.className)},removeClass:function(t,e){t.className=t.className.replace(new RegExp("\\b ?"+e+"\\b","g"),"")},addClass:function(t,e){t.className=t.className.replace(new RegExp("\\b"+e+"\\b|$")," "+e)},isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"[object Number]"===toString.call(t)},isString:function(t){return"[object String]"===toString.call(t)}};"function"==typeof define&&define.amd&&define([],function(){return Console})}).call(this);
(function(){function t(t,e){return function(n){n.keyCode===e&&(t.toggle(),n.preventDefault())}}function e(t){var e=0;return function(n){switch(n.keyCode){case 38:void 0!==t.history[e]&&(n.target.value=t.history[e++]),e>=t.history.length&&(e=t.history.length-1),n.preventDefault();break;case 40:void 0!==t.history[e]&&(n.target.value=t.history[e--]),0>e&&(e=0);break;default:e=0,t.history[0]=n.target.value}}}function n(t){return function(e){switch(e.keyCode){case 13:var n=e.target.value;e.target.value="",n&&t.log("command",n),t.history.unshift(""),t.history.length>t.cfg.historySize&&(t.history=t.history.splice(0,t.cfg.historySize)),t.dispatch(n)}}}function o(t){t&&(document.head.appendChild(r.toElement("<style>"+t+"</style>")),l=!1)}var i=this,s={hotkey:192,welcome:"",onShow:null,onHide:null,defaultHandler:null,caseSensitive:!0,historySize:256},l=".console-panel{z-index:99999;display:block;visibility:hidden;height:50%;position:fixed;top:0;left:0;width:100%;background-color:rgba(0,0,0,.8);margin-top:-50%;transition:margin-top 100ms ease-out 1ms}.console-panel.shown{visibility:visible;margin-top:0}.console-history,.console-input{margin:0;padding:2px 5px;box-sizing:border-box;position:absolute;width:100%;font:14px/20px Menlo,monospace;color:#DDD;letter-spacing:.05em}.console-history{bottom:18px}.console-history dd,.console-history dt{white-space:pre;margin:0}.console-history dt{color:#7E0}.console-input{outline:0;background-color:transparent;border:0;bottom:0;line-height:16px;padding:4px 5px}",a='<label class="console-panel"><dl class="console-history"></dl><input class="console-input"/></label>';i.Console=function(i,c){var h=r.defaults(c||{},s);h.historySize++,this.history=[],this.cfg=h,this.commands={};for(var d in i)i.hasOwnProperty(d)&&(this.commands[d]={__fn:i[d]});this.panelEl=r.toElement(a),this.logEl=this.panelEl.firstChild,this.inputEl=this.logEl.nextSibling,h.hotkey&&window.addEventListener("keydown",t(this,h.hotkey)),h.welcome&&this.log("message",h.welcome),this.inputEl.addEventListener("keydown",e(this)),this.inputEl.addEventListener("keyup",n(this)),document.body.appendChild(this.panelEl),o(l)},Console.prototype.toggle=function(t){"off"===t||this.isShown?(r.removeClass(this.panelEl,"shown"),this.isShown=!1,r.isFunction(this.cfg.onHide)&&this.cfg.onHide(this)):"on"!==t&&this.isShown||(r.addClass(this.panelEl,"shown"),this.inputEl.focus(),this.isShown=!0,r.isFunction(this.cfg.onShow)&&this.cfg.onShow(this))},Console.prototype.log=function(t){var e,n=Array.prototype.slice.call(arguments,1);switch(t){case"command":e=r.toElement("<dt></dt>"),e.appendChild(document.createTextNode(n[0]));break;case"message":e=r.toElement("<dd>"+n.join(" ")+"</dd>");break;default:n.unshift(t),e=r.toElement("<dd>"+n.join(" ")+"</dd>")}this.logEl.appendChild(e)},Console.prototype.dispatch=function(t){var e=t.split(" "),n=this.commands[e[0]];if(n){for(;r.isString(n.__fn);)if(n=this.commands[n.__fn],n===e[0])throw new Error("Alias loop.");var o=n&&n.__fn.apply(n,e.splice(1));o&&this.log("message",o)}else r.isFunction(this.cfg.defaultHandler)&&this.cfg.defaultHandler.apply(this,e)},Console.prototype.register=function(t,e,n){return this.commands[t]=r.defaults({__fn:e},n),this};var r={defaults:function(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},toElement:function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},preventDefault:function(t){t.preventDefault()},hasClass:function(t,e){new RegExp("\\b"+e+"\\b").test(t.className)},removeClass:function(t,e){t.className=t.className.replace(new RegExp("\\b ?"+e+"\\b","g"),"")},addClass:function(t,e){t.className=t.className.replace(new RegExp("\\b"+e+"\\b|$")," "+e)},isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"[object Number]"===toString.call(t)},isString:function(t){return"[object String]"===toString.call(t)}};"function"==typeof define&&define.amd&&define([],function(){return Console})}).call(this);